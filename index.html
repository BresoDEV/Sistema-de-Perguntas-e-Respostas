<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>V 4</title>
    </head>
    <style>
      *{
        background-color: #181818;
        font-weight: bold;
        user-select: none;
      }
      .pergunta{
        background-color: #3a495b;
        color: aliceblue;
        border-radius: 20px;
        padding: 20px;
        margin-top: 20px;
        margin-bottom: 20px;
      }
      .justificativa{
        background-color: #406b6d;
        color: aliceblue;
        border-radius: 20px;
        padding: 20px;
        margin-top: 20px;
        margin-bottom: 20px;
        font-weight: normal;
      }
      .alternativa{
        background-color: #333;
        color: aliceblue;
        border-radius: 20px;
        padding: 10px;
        margin-top: 5px;
      }
      .errada{
        background-color: rgb(190, 88, 88); 
      }
      .certa{
        background-color: rgb(134, 169, 124); 
      }
      .fonte-errada{
        color: rgb(190, 88, 88);  
        background-color: #333;
      }
      .fonte-certa{
        color: rgb(75, 200, 40); 
        background-color: #333; 
      }
       
      button{
        width: 100%;
        background-color: rgb(61, 103, 61);
        border-radius: 10px;
        border: none;
        padding-top: 10px;
        padding-bottom: 10px;
        color: aliceblue;
        margin-bottom: 5px;
      }

       summary{ 
        border-radius: 10px;
        background-color: #333;
        color: rgb(190, 88, 88);
        padding: 5px;
       } 
       details{ 
        border-radius: 10px;
        background-color: #333;
        color: #ffffff; 
       }
        p{ 
        border-radius: 10px;
        background-color: #333;
        color: #ffffff; 
        margin-left: 5px;
       }
       

       .topo{
        margin: -5px;
        height: 10px;
        background-color: rgb(73, 162, 192);
       }

       .finzalizar{
        background-color: rgb(190, 88, 88);
       }

       input{
        background-color: #404040;
        margin-top: 5px;
        margin-bottom: 5px;
        width: 90vw;
        padding: 5px;
        border-radius: 5px;
        border: none;
        text-align: center;
        color: aliceblue;
       }
       h2{
        background-color: #406b6d;
        font-size: 30vw;
        margin: 0;
       }
       .fonte-amarela{
        color: #c7c76e;
        background-color: #333;
       }
    </style>
    <body>

      <div id="topo" class="topo"></div>

        
           
        <div id="pergunta" class="pergunta">
            1: Qual a cor do cavalo branco de Napole√£o?
        </div>
        <div id="alternativa1" class="alternativa">A: Branco</div>
        <div id="alternativa2" class="alternativa">B: Vermelho</div>
        <div id="alternativa3" class="alternativa">C: Amarelo</div>
        <div id="alternativa4" class="alternativa">D: Preto</div>
        <div id="justificativa" class="justificativa">
            Justificativa:
            <br>
            <br>
            O cavalo era branco porque era muito frio e ele congelou
        </div>

        <details id="details">
          <summary>Respondidas Incorretamente:</summary>
          <b id="local"></b>
        </details>
        <br>

        
        <button id="pular">Pular</button>
        
        <button id="proxima">Pr√≥xima</button>
        <button id="finalizar" class="finzalizar">Finalizar</button>
    </body>
    <script src="perguntas.js"></script>
    <script>
 
      _ocultar('details')
      _ocultar('finalizar')

      addClick('finalizar',()=>{
        localStorage.setItem('index',1000)
        window.location.reload()
      })



      //DEV MENU
      addClick('topo',()=>{

        document.body.innerHTML = `
          <center>
            <br>
            <br>
            <br>
            <button id="bt1">Reiniciar Tudo</button>
            <br>
            <button id="bt2">Apagar Respostas Erradas</button>
            <hr>
            <input id="inpt" type="number" min="1" max="200">
            <br>
            <button id="bt3">Mudar Pergunta</button>
            <br> 
            <br>
            <br>
            <br>
            <button id="bt4">Voltar</button>


          </center>

        
        `

        getID('inpt').value = index
        

        addClick('bt1',()=>{
            localStorage.setItem('index',1)
            localStorage.setItem('pontuacao',0)
            localStorage.setItem('erradas',0)
            localStorage.removeItem('respostasErradas')
            window.location.reload()
        })

        addClick('bt2',()=>{
          localStorage.removeItem('respostasErradas')
          alert('Lista de respostas erradas foi deletado')
        })
        addClick('bt3',()=>{
          localStorage.setItem('index',getID('inpt').value)
          alert('Indice das perguntas foi alterado para '+getID('inpt').value)
        })

        addClick('bt4',()=>{
          window.location.reload()
        })
       
      })
      //---------------------------------------------




      //Salva as perguntas que foram respondidas erradas, pra exiir no final
      function salvarPerguntas(p,respostaSelecionada,respostaCerta,_justificativa){

        var arraia;

        if(!localStorage.getItem('respostasErradas')){
          arraia = {
            'pergunta1':p,
            'selecionada1':respostaSelecionada,
            'correta1':respostaCerta,
            'justificativa1':_justificativa,
          }
          localStorage.setItem('respostasErradas', JSON.stringify(arraia))
        }
        else{

          arraia = JSON.parse(localStorage.getItem('respostasErradas'));
          var ultimo = 1
          while(arraia['pergunta'+ultimo]){
            ultimo++
          }
          console.log(ultimo)
          arraia['pergunta'+ultimo] = p;
          arraia['selecionada'+ultimo] = respostaSelecionada;
          arraia['correta'+ultimo] = respostaCerta;
          arraia['justificativa'+ultimo] = _justificativa;

          localStorage.setItem('respostasErradas', JSON.stringify(arraia))
        }
        console.log(localStorage.getItem('respostasErradas'))

      }

      //pega o index--------------------------
      const params = new URLSearchParams(window.location.search);
      var index = 1;
      var pontuacao = 0;
      var erradas = 0;
      
      if(localStorage.getItem('index')){
        index = parseInt(localStorage.getItem('index'))
      }else{
        localStorage.setItem('index',1)
      }

      if(localStorage.getItem('pontuacao')){
        pontuacao = parseInt(localStorage.getItem('pontuacao'))
      }else{
        localStorage.setItem('pontuacao',0)
      }

      if(localStorage.getItem('erradas')){
        erradas = parseInt(localStorage.getItem('erradas'))
      }else{
        localStorage.setItem('erradas',0)
      }




      //Finalizou------------------------------------
      if(!perguntas['pergunta_'+index]){
        
        getID('justificativa').innerHTML = 'üèÜ Perguntas finalizadas üèÜ'+
        '<p>‚úÖAcertos: <font class="fonte-certa">' + pontuacao + '</font></p>' +
        '<p>‚ùåErros: <font class="fonte-errada">' + erradas + '</font></p>'+
        '<h2 id="h2">üèÖ</h2>';

        //----Calcular a medalha
       
        if(pontuacao / 4 >= erradas){
          getID('h2').innerHTML = 'ü•à'
        }
        else if(pontuacao / 2 >= erradas){
          getID('h2').innerHTML = 'ü•â'
        }
        if(erradas == 0 && pontuacao >= 1){
          getID('h2').innerHTML = 'ü•á'
        }
        
        console.log('ü•â'+pontuacao / 4)
        console.log('ü•à'+pontuacao / 2) 
        //------
         

        getID('justificativa').style.textAlign = 'center'

        _ocultar('pergunta')
        _ocultar('alternativa1')
        _ocultar('alternativa2')
        _ocultar('alternativa3')
        _ocultar('alternativa4')

        
        _exibir('proxima')
        getID('proxima').innerHTML = "Reiniciar"
        addClick('proxima',()=>{
          localStorage.removeItem('respostasErradas')

          localStorage.setItem('index',1)
          localStorage.setItem('pontuacao',0)
          localStorage.setItem('erradas',0)
          window.location.href = 'index.html?index=1&pontuacao=0&erradas=0'
        })


          
        //--------------------------------
        _exibir('details') 
        
        var __ = 1
        var s = ''
        var arraia = JSON.parse(localStorage.getItem('respostasErradas'));
        while(arraia['pergunta'+__]){

          s += '<hr>';
          s += '<p>Pergunta: ' + arraia['pergunta'+__] + '</p>';
          s += '<p>Assinalada: <font class="fonte-errada">' + arraia['selecionada'+__] + '</font></p>';
          s += '<p>Correta: <font class="fonte-certa">' + arraia['correta'+__] + '</font></p>';
          s += '<p>Justificativa: <font class="fonte-amarela">' + arraia['justificativa'+__] + '</font></p>';
          
          __++
        }
        s += '<br><br>';
        getID('local').innerHTML = s
        //---------------------------
         
        throw new Error("Parando execu√ß√£o manualmente");
      }


      //Percorre o array------------------------------
      for (const chave in perguntas) {

        
        if(chave == 'pergunta_'+index) {

          //Processa e refina a pergunta, add quebra de linhas e espa√ßos-----------
          var reajustada = perguntas['pergunta_'+index]
          reajustada = reajustada.replace('IIII - ','<br>IIII : ')
          reajustada = reajustada.replace('III - ','<br>III : ')
          reajustada = reajustada.replace('II - ','<br>II : ')
          reajustada = reajustada.replace('I - ','<br>I : ')
          reajustada = reajustada.replace('IV - ','<br>IV : ')
          reajustada = reajustada.replace('V - ','<br>V : ')
          reajustada = reajustada.replace('VI - ','<br>VI : ')
          reajustada = reajustada.replace(':',':<br>')
 

          reajustada = reajustada.replace('(1) ','<br>(1) ')
          reajustada = reajustada.replace('(2) ','<br>(2) ')
          reajustada = reajustada.replace('(3) ','<br>(3) ')
          reajustada = reajustada.replace('(4) ','<br>(4) ')
        
          for (let i = 0; i < 5; i++) {
            reajustada = reajustada.replace('( ) ','<br>(  ) ')
          reajustada = reajustada.replace('( )','<br>(  )')
          }

          getID('pergunta').innerHTML = index+':<br><br>'+reajustada;
          
          //------------
          getID('alternativa1').innerHTML = perguntas['pergunta_'+index+'_alternativa_1'];
          getID('alternativa2').innerHTML = perguntas['pergunta_'+index+'_alternativa_2'];
          getID('alternativa3').innerHTML = perguntas['pergunta_'+index+'_alternativa_3'];
          getID('alternativa4').innerHTML = perguntas['pergunta_'+index+'_alternativa_4'];
          
          getID('justificativa').innerHTML = 'Justificativa: <br><br>' + perguntas['pergunta_'+index+'_justificativa'];
        
        
        
          addClick('alternativa1',()=>{ 

            selecionar('alternativa1');

            if(getID('alternativa1').innerHTML == perguntas['pergunta_'+index+'_resposta_correta']){
              pontuacao++
              addCerto('alternativa1');
              _exibir('justificativa')
              _exibir('proxima')
              _exibir('finalizar')
 
              index++;
              salvarProgresso()
            }
            else{
              erradas++
              addErrada('alternativa1');
              _exibir('justificativa')
              _exibir('proxima')
              _exibir('finalizar')
              buscarAlternativaCorreta(perguntas['pergunta_'+index+'_resposta_correta'])

              salvarPerguntas(
                getID('pergunta').innerHTML,
                getID('alternativa1').innerHTML,
                perguntas['pergunta_'+index+'_resposta_correta'],
                perguntas['pergunta_'+index+'_justificativa']
                )
 
                index++;
              salvarProgresso()
            }

          });
          addClick('alternativa2',()=>{

            selecionar('alternativa2');

            if(getID('alternativa2').innerHTML == perguntas['pergunta_'+index+'_resposta_correta']){
              pontuacao++
              addCerto('alternativa2');
              _exibir('justificativa')
              _exibir('proxima')
              _exibir('finalizar')
 
              index++;
              salvarProgresso()
            }
            else{
              erradas++
              addErrada('alternativa2');
              _exibir('justificativa')
              _exibir('proxima')
              _exibir('finalizar')
              buscarAlternativaCorreta(perguntas['pergunta_'+index+'_resposta_correta'])

              salvarPerguntas(
                getID('pergunta').innerHTML,
                getID('alternativa2').innerHTML,
                perguntas['pergunta_'+index+'_resposta_correta'],
                perguntas['pergunta_'+index+'_justificativa']
                )
 
                index++;
              salvarProgresso()
            }

          });
          addClick('alternativa3',()=>{

            selecionar('alternativa3');

            if(getID('alternativa3').innerHTML == perguntas['pergunta_'+index+'_resposta_correta']){
              pontuacao++
              addCerto('alternativa3');
              _exibir('justificativa')
              _exibir('proxima')
              _exibir('finalizar')
 
              index++;
              salvarProgresso()
            }
            else{
              erradas++
              addErrada('alternativa3');
              _exibir('justificativa')
              _exibir('proxima')
              _exibir('finalizar')
              buscarAlternativaCorreta(perguntas['pergunta_'+index+'_resposta_correta'])

              salvarPerguntas(
                getID('pergunta').innerHTML,
                getID('alternativa3').innerHTML,
                perguntas['pergunta_'+index+'_resposta_correta'],
                perguntas['pergunta_'+index+'_justificativa']
                )
                 
                index++;
              salvarProgresso()
            }

          });
          addClick('alternativa4',()=>{

            selecionar('alternativa4');

            if(getID('alternativa4').innerHTML == perguntas['pergunta_'+index+'_resposta_correta']){
              pontuacao++
              addCerto('alternativa4');
              _exibir('justificativa')
              _exibir('proxima')
              _exibir('finalizar')
               
              index++;
              salvarProgresso()
            }
            else{
              erradas++
              addErrada('alternativa4');
              _exibir('justificativa')
              _exibir('proxima')
              _exibir('finalizar')
              buscarAlternativaCorreta(perguntas['pergunta_'+index+'_resposta_correta'])

              salvarPerguntas(
                getID('pergunta').innerHTML,
                getID('alternativa4').innerHTML,
                perguntas['pergunta_'+index+'_resposta_correta'],
                perguntas['pergunta_'+index+'_justificativa']
                )
 
              index++;
              salvarProgresso()
            }

          });
        
        
        
        
        }
  
      }


      function salvarProgresso(){
        localStorage.setItem('index',index)
        localStorage.setItem('pontuacao',pontuacao)
        localStorage.setItem('erradas',erradas)
      }

      addClick('proxima',()=>{
        
index++
        salvarProgresso()

        window.location.href = 'index.html?index='+index+'&pontuacao='+pontuacao+'&erradas='+erradas
      })

        
addClick('pular',()=>{
        
index++
        salvarProgresso()

        window.location.href = 'index.html?index='+index+'&pontuacao='+pontuacao+'&erradas='+erradas
      })
        
      
      function buscarAlternativaCorreta(resposta){
        
         if(getID('alternativa1').innerHTML == resposta){
          addCerto('alternativa1');
         }
         if(getID('alternativa2').innerHTML == resposta){
          addCerto('alternativa2');
         }
         if(getID('alternativa3').innerHTML == resposta){
          addCerto('alternativa3');
         }
         if(getID('alternativa4').innerHTML == resposta){
          addCerto('alternativa4');
         } 
      }












      function addClick(id, func){
        getID(id).addEventListener('click',()=>{
          func();
        })
      }
      function getID(id){
        if(document.getElementById(id)){
          return document.getElementById(id);
        }
        return id
      }
     

       
     


      function _ocultar(id){
        getID(id).style.display = 'none';
      }
      function _exibir(id){
        getID(id).style.display = 'block'; 
      }

      function addErrada(id){
        getID(id).style.backgroundColor = 'rgb(190, 88, 88)';
      }

      function addCerto(id){
        getID(id).style.backgroundColor = 'rgb(134, 169, 124)';
      }
      function selecionar(id){
        getID(id).style.backgroundColor = "rgb(140, 172, 172)"
      }

      _ocultar('proxima')
      _ocultar('justificativa')
      _ocultar('details')


      console.log('index: '+index)
      console.log('pontuacao: '+pontuacao)
      console.log('erradas: '+erradas) 
    </script>
</html>


